<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå®šä¹‰åè®®å¸§æ•°æ®ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 30px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #555;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .row {
            display: flex;
            gap: 15px;
        }
        
        .row .form-group {
            flex: 1;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-right: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .result-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            word-break: break-all;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result-label {
            color: #4ec9b0;
            font-weight: bold;
            margin-bottom: 10px;
            display: block;
        }
        
        .param-group {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }
        
        .param-group-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .help-text {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        
        .frame-structure {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .hidden {
            display: none;
        }
        
        .copy-btn {
            background: #28a745;
            padding: 8px 15px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ è‡ªå®šä¹‰åè®®å¸§æ•°æ®ç”Ÿæˆå™¨</h1>
        <p class="subtitle">æ”¯æŒå‘½ä»¤å¸§å’Œåº”ç­”å¸§ç”Ÿæˆ | åè®®ç‰ˆæœ¬ V1.0</p>
        
        <div class="section">
            <div class="section-title">ğŸ“‹ å¸§ç±»å‹é€‰æ‹©</div>
            <div class="form-group">
                <label>å¸§ç±»å‹</label>
                <select id="frameType">
                    <option value="command">å‘½ä»¤å¸§ (ä¸»æœºâ†’ä»æœº)</option>
                    <option value="response">åº”ç­”å¸§ (ä»æœºâ†’ä¸»æœº)</option>
                </select>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">âš™ï¸ åŸºæœ¬å‚æ•°</div>
            <div class="row">
                <div class="form-group">
                    <label>äº§å“åœ°å€ (DEV)</label>
                    <input type="number" id="devAddr" value="3" min="0" max="255" />
                    <div class="help-text">é»˜è®¤: 0x03</div>
                </div>
                <div class="form-group">
                    <label>æ¨¡å—åœ°å€ (MOD)</label>
                    <input type="number" id="modAddr" value="2" min="0" max="255" />
                    <div class="help-text">é»˜è®¤: 0x02</div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ“¨ å‘½ä»¤é€‰æ‹©</div>
            <div class="form-group">
                <label>å‘½ä»¤ç  (CMD)</label>
                <select id="cmdCode">
                    <option value="0x01">0x01 - æ¡æ‰‹ (CMD_HAND_SHAKE)</option>
                    <option value="0x02">0x02 - æŸ¥è¯¢è½¯ä»¶ç‰ˆæœ¬ (CMD_GET_SOFTWARE_VERSION)</option>
                    <option value="0x03">0x03 - è®¾ç½®ç¡¬ä»¶ç‰ˆæœ¬ (CMD_SET_HARDWARE_VERSION)</option>
                    <option value="0x04">0x04 - æŸ¥è¯¢ç¡¬ä»¶ç‰ˆæœ¬ (CMD_GET_HARDWARE_VERSION)</option>
                    <option value="0x05">0x05 - è®¾ç½®åºåˆ—å· (CMD_SET_SERIAL_NUMBER)</option>
                    <option value="0x06">0x06 - æŸ¥è¯¢åºåˆ—å· (CMD_GET_SERIAL_NUMBER)</option>
                    <option value="0x07">0x07 - ç³»ç»Ÿå¤ä½ (CMD_CTRL_SOFT_RESET)</option>
                    <option value="0x08">0x08 - ç³»ç»Ÿè‡ªæ£€ (CMD_CTRL_SELF_CHECK)</option>
                    <option value="0x09">0x09 - ä½åŠŸè€—æ§åˆ¶ (CMD_CTRL_LOW_POWER_MODE)</option>
                    <option value="0x0A">0x0A - å¯åŠ¨åœ¨çº¿å‡çº§ (CMD_CTRL_IAP)</option>
                    <option value="0x0B">0x0B - æ§åˆ¶ä¸Šä¼ æ¨¡å¼ (CMD_CTRL_UPLOAD_MODE)</option>
                    <option value="0x0C">0x0C - çŠ¶æ€ä¸Šä¼  (CMD_STATUS_UPLOAD)</option>
                    <option value="0x2F">0x2F - å¸§è§£æé”™è¯¯åº”ç­” (CMD_FRAME_PARSER_ERR_ACK)</option>
                    <option value="0x30">0x30 - æ§åˆ¶è„‰å†²åºåˆ—è¾“å‡º (CMD_CTRL_PULSE_ENGINE_START)</option>
                    <option value="0x31">0x31 - è·å–è„‰å†²åºåˆ—è¾“å‡ºçŠ¶æ€ (CMD_GET_PULSE_ENGINE_STATUS)</option>
                    <option value="0x32">0x32 - è®¾ç½®è„‰å†²åºåˆ—è¾“å‡ºæ¨¡å¼ (CMD_SET_PULSE_ENGINE_TRIGGER_MODE)</option>
                    <option value="0x33">0x33 - è·å–è„‰å†²åºåˆ—è¾“å‡ºæ¨¡å¼ (CMD_GET_PULSE_ENGINE_TRIGGER_MODE)</option>
                    <option value="0x34">0x34 - è®¾ç½®è„‰å†²åºåˆ—å‚æ•° (CMD_SET_PULSE_ENGINE_PARAMETERS)</option>
                    <option value="0x35">0x35 - è·å–è„‰å†²åºåˆ—å‚æ•° (CMD_GET_PULSE_ENGINE_PARAMETERS)</option>
                    <option value="0x36">0x36 - è®¾ç½®å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•° (CMD_SET_ECG_SYNC_TRIGGER_PARAMETERS)</option>
                    <option value="0x37">0x37 - è·å–å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•° (CMD_GET_ECG_SYNC_TRIGGER_PARAMETERS)</option>
                    <option value="0x38">0x38 - è®¾ç½®è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼ (CMD_SET_OCD_VOLTAGE_THRESHOLD)</option>
                    <option value="0x39">0x39 - è·å–è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼ (CMD_GET_OCD_VOLTAGE_THRESHOLD)</option>
                    <option value="0x3A">0x3A - è„‰å†²åºåˆ—è¾“å‡ºå®ŒæˆçŠ¶æ€ä¸ŠæŠ¥ (CMD_PULSE_ENGINE_STATUS_UPLOAD)</option>
                </select>
            </div>
            
            <div id="responseAckGroup" class="form-group hidden">
                <label>åº”ç­”ç  (ACK)</label>
                <select id="ackCode">
                    <option value="0x00">0x00 - ACK_OK (æ“ä½œæˆåŠŸ)</option>
                    <option value="0x01">0x01 - ACK_ERR_UNKNOWN (æœªçŸ¥é”™è¯¯)</option>
                    <option value="0x02">0x02 - ACK_ERR_LEN_FIELD (é•¿åº¦å­—æ®µè¶…é™)</option>
                    <option value="0x03">0x03 - ACK_ERR_CHECKSUM (æ ¡éªŒé”™è¯¯)</option>
                    <option value="0x04">0x04 - ACK_ERR_TAIL (å¸§å°¾ä¸åŒ¹é…)</option>
                    <option value="0x05">0x05 - ACK_ERR_BUF_TOO_SMALL (ç¼“å†²åŒºè¿‡å°)</option>
                    <option value="0x06">0x06 - ACK_ERR_TIMEOUT (æ¥æ”¶è¶…æ—¶)</option>
                    <option value="0x11">0x11 - ACK_ERR_PRODUCT_ADDR (äº§å“åœ°å€é”™è¯¯)</option>
                    <option value="0x12">0x12 - ACK_ERR_MODULE_ADDR (æ¨¡å—åœ°å€é”™è¯¯)</option>
                    <option value="0x13">0x13 - ACK_ERR_INVALID_PARAM (æ•°æ®å‚æ•°æ— æ•ˆ)</option>
                    <option value="0x14">0x14 - ACK_ERR_UNSUP_CMD (ä¸æ”¯æŒçš„å‘½ä»¤)</option>
                    <option value="0x15">0x15 - ACK_ERR_BUSY (æ“ä½œæ­£å¿™)</option>
                    <option value="0x16">0x16 - ACK_ERR_OPERATE_ABNORMAL (æ“ä½œå¼‚å¸¸)</option>
                    <option value="0x17">0x17 - ACK_ERR_MODE_ABNORMAL (æ¨¡å¼å¼‚å¸¸)</option>
                    <option value="0x18">0x18 - ACK_ERR_OPERATE_INVALID (æ“ä½œæ— æ•ˆ)</option>
                    <option value="0x19">0x19 - ACK_ERR_MODULE_LOCK (æ¨¡å—é”å®š)</option>
                    <option value="0x20">0x20 - ACK_ERR_SYSTEM_LOCK (ç³»ç»Ÿé”å®š)</option>
                    <option value="0x80">0x80 - ACK_IN_PROGERESS (å·²æ¥å—ï¼Œæ­£åœ¨æ‰§è¡Œ)</option>
                </select>
            </div>
        </div>
        
        <div class="section" id="paramSection">
            <div class="section-title">ğŸ“ å‘½ä»¤å‚æ•°</div>
            <div id="paramContainer">
                <div class="alert alert-info">
                    é€‰æ‹©å‘½ä»¤åå°†æ˜¾ç¤ºå¯¹åº”çš„å‚æ•°è¾“å…¥ç•Œé¢
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-title">ğŸ”§ æ“ä½œ</div>
            <button class="btn" onclick="generateFrame()">ç”Ÿæˆå¸§æ•°æ®</button>
            <button class="btn btn-secondary" onclick="clearAll()">æ¸…ç©º</button>
        </div>
        
        <div class="section" id="resultSection" style="display: none;">
            <div class="section-title">ğŸ“Š ç”Ÿæˆç»“æœ</div>
            <div class="result-label">åå…­è¿›åˆ¶æ ¼å¼:</div>
            <div class="result-box" id="hexResult"></div>
            <button class="btn copy-btn" onclick="copyToClipboard('hexResult')">å¤åˆ¶åå…­è¿›åˆ¶</button>
            
            <div class="result-label" style="margin-top: 20px;">Cè¯­è¨€æ•°ç»„æ ¼å¼:</div>
            <div class="result-box" id="cArrayResult"></div>
            <button class="btn copy-btn" onclick="copyToClipboard('cArrayResult')">å¤åˆ¶Cæ•°ç»„</button>
            
            <div class="result-label" style="margin-top: 20px;">å¸§ç»“æ„è§£æ:</div>
            <div class="result-box" id="frameParseResult"></div>
        </div>
    </div>
    
    <script>
        // Modbus CRC16 æŸ¥æ‰¾è¡¨
        const crc16_8005_table = [
            0x0000, 0xC0C1, 0xC181, 0x0140, 0xC301, 0x03C0, 0x0280, 0xC241,
            0xC601, 0x06C0, 0x0780, 0xC741, 0x0500, 0xC5C1, 0xC481, 0x0440,
            0xCC01, 0x0CC0, 0x0D80, 0xCD41, 0x0F00, 0xCFC1, 0xCE81, 0x0E40,
            0x0A00, 0xCAC1, 0xCB81, 0x0B40, 0xC901, 0x09C0, 0x0880, 0xC841,
            0xD801, 0x18C0, 0x1980, 0xD941, 0x1B00, 0xDBC1, 0xDA81, 0x1A40,
            0x1E00, 0xDEC1, 0xDF81, 0x1F40, 0xDD01, 0x1DC0, 0x1C80, 0xDC41,
            0x1400, 0xD4C1, 0xD581, 0x1540, 0xD701, 0x17C0, 0x1680, 0xD641,
            0xD201, 0x12C0, 0x1380, 0xD341, 0x1100, 0xD1C1, 0xD081, 0x1040,
            0xF001, 0x30C0, 0x3180, 0xF141, 0x3300, 0xF3C1, 0xF281, 0x3240,
            0x3600, 0xF6C1, 0xF781, 0x3740, 0xF501, 0x35C0, 0x3480, 0xF441,
            0x3C00, 0xFCC1, 0xFD81, 0x3D40, 0xFF01, 0x3FC0, 0x3E80, 0xFE41,
            0xFA01, 0x3AC0, 0x3B80, 0xFB41, 0x3900, 0xF9C1, 0xF881, 0x3840,
            0x2800, 0xE8C1, 0xE981, 0x2940, 0xEB01, 0x2BC0, 0x2A80, 0xEA41,
            0xEE01, 0x2EC0, 0x2F80, 0xEF41, 0x2D00, 0xEDC1, 0xEC81, 0x2C40,
            0xE401, 0x24C0, 0x2580, 0xE541, 0x2700, 0xE7C1, 0xE681, 0x2640,
            0x2200, 0xE2C1, 0xE381, 0x2340, 0xE101, 0x21C0, 0x2080, 0xE041,
            0xA001, 0x60C0, 0x6180, 0xA141, 0x6300, 0xA3C1, 0xA281, 0x6240,
            0x6600, 0xA6C1, 0xA781, 0x6740, 0xA501, 0x65C0, 0x6480, 0xA441,
            0x6C00, 0xACC1, 0xAD81, 0x6D40, 0xAF01, 0x6FC0, 0x6E80, 0xAE41,
            0xAA01, 0x6AC0, 0x6B80, 0xAB41, 0x6900, 0xA9C1, 0xA881, 0x6840,
            0x7800, 0xB8C1, 0xB981, 0x7940, 0xBB01, 0x7BC0, 0x7A80, 0xBA41,
            0xBE01, 0x7EC0, 0x7F80, 0xBF41, 0x7D00, 0xBDC1, 0xBC81, 0x7C40,
            0xB401, 0x74C0, 0x7580, 0xB541, 0x7700, 0xB7C1, 0xB681, 0x7640,
            0x7200, 0xB2C1, 0xB381, 0x7340, 0xB101, 0x71C0, 0x7080, 0xB041,
            0x5000, 0x90C1, 0x9181, 0x5140, 0x9301, 0x53C0, 0x5280, 0x9241,
            0x9601, 0x56C0, 0x5780, 0x9741, 0x5500, 0x95C1, 0x9481, 0x5440,
            0x9C01, 0x5CC0, 0x5D80, 0x9D41, 0x5F00, 0x9FC1, 0x9E81, 0x5E40,
            0x5A00, 0x9AC1, 0x9B81, 0x5B40, 0x9901, 0x59C0, 0x5880, 0x9841,
            0x8801, 0x48C0, 0x4980, 0x8941, 0x4B00, 0x8BC1, 0x8A81, 0x4A40,
            0x4E00, 0x8EC1, 0x8F81, 0x4F40, 0x8D01, 0x4DC0, 0x4C80, 0x8C41,
            0x4400, 0x84C1, 0x8581, 0x4540, 0x8701, 0x47C0, 0x4680, 0x8641,
            0x8201, 0x42C0, 0x4380, 0x8341, 0x4100, 0x81C1, 0x8081, 0x4040
        ];
        
        // Modbus CRC16è®¡ç®— (åˆå§‹å€¼0xFFFF, XORè¾“å‡º0x0000)
        function crc16_modbus(buffer) {
            let crc = 0xFFFF;
            for (let i = 0; i < buffer.length; i++) {
                const index = (crc ^ buffer[i]) & 0xFF;
                crc = (crc >>> 8) ^ crc16_8005_table[index];
            }
            return crc ^ 0x0000;
        }
        
        // å°†æ•°å­—è½¬æ¢ä¸ºå°ç«¯åºçš„2å­—èŠ‚æ•°ç»„
        function toLittleEndian16(value) {
            return [value & 0xFF, (value >> 8) & 0xFF];
        }
        
        // å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„
        function hexStringToBytes(hex) {
            hex = hex.replace(/\s+/g, '');
            const bytes = [];
            for (let i = 0; i < hex.length; i += 2) {
                bytes.push(parseInt(hex.substr(i, 2), 16));
            }
            return bytes;
        }
        
        // å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
        function bytesToHexString(bytes, separator = ' ') {
            return bytes.map(b => b.toString(16).padStart(2, '0').toUpperCase()).join(separator);
        }
        
        // è·å–å‘½ä»¤å‚æ•°
        function getCommandParams() {
            const cmd = parseInt(document.getElementById('cmdCode').value);
            const frameType = document.getElementById('frameType').value;
            const params = [];
            
            switch(cmd) {
                case 0x03: // è®¾ç½®ç¡¬ä»¶ç‰ˆæœ¬
                    const hwVersion = document.getElementById('hwVersion')?.value || '';
                    if (hwVersion) {
                        for (let i = 0; i < hwVersion.length; i++) {
                            params.push(hwVersion.charCodeAt(i));
                        }
                    }
                    break;
                    
                case 0x05: // è®¾ç½®åºåˆ—å·
                    const sn = document.getElementById('serialNumber')?.value || '';
                    if (sn) {
                        for (let i = 0; i < sn.length; i++) {
                            params.push(sn.charCodeAt(i));
                        }
                    }
                    break;
                    
                case 0x30: // æ§åˆ¶è„‰å†²åºåˆ—è¾“å‡º
                    const control = parseInt(document.getElementById('pulseControl')?.value || '0');
                    params.push(control);
                    break;
                    
                case 0x32: // è®¾ç½®è„‰å†²åºåˆ—è¾“å‡ºæ¨¡å¼
                    const mode = parseInt(document.getElementById('pulseMode')?.value || '0');
                    params.push(mode);
                    break;
                    
                case 0x34: // è®¾ç½®è„‰å†²åºåˆ—å‚æ•°
                    const pulseParams = {
                        num_of_group: parseInt(document.getElementById('num_of_group')?.value || '1'),
                        group_num: parseInt(document.getElementById('group_num')?.value || '1'),
                        group_gap: parseInt(document.getElementById('group_gap')?.value || '100'),
                        train_per_group: parseInt(document.getElementById('train_per_group')?.value || '10'),
                        train_gap: parseInt(document.getElementById('train_gap')?.value || '5'),
                        periods_per_train: parseInt(document.getElementById('periods_per_train')?.value || '20'),
                        np_gap: parseInt(document.getElementById('np_gap')?.value || '1000'),
                        pos_pw: parseInt(document.getElementById('pos_pw')?.value || '500'),
                        pn_gap: parseInt(document.getElementById('pn_gap')?.value || '1000'),
                        neg_pw: parseInt(document.getElementById('neg_pw')?.value || '500')
                    };
                    params.push(pulseParams.num_of_group);
                    params.push(pulseParams.group_num);
                    params.push(...toLittleEndian16(pulseParams.group_gap));
                    params.push(...toLittleEndian16(pulseParams.train_per_group));
                    params.push(...toLittleEndian16(pulseParams.train_gap));
                    params.push(...toLittleEndian16(pulseParams.periods_per_train));
                    params.push(...toLittleEndian16(pulseParams.np_gap));
                    params.push(...toLittleEndian16(pulseParams.pos_pw));
                    params.push(...toLittleEndian16(pulseParams.pn_gap));
                    params.push(...toLittleEndian16(pulseParams.neg_pw));
                    break;
                    
                case 0x36: // è®¾ç½®å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•°
                    const ecgParams = {
                        trigger_delay_ms: parseInt(document.getElementById('trigger_delay_ms')?.value || '50'),
                        stop_delay_ms: parseInt(document.getElementById('stop_delay_ms')?.value || '500'),
                        interval_R: parseInt(document.getElementById('interval_R')?.value || '2'),
                        repeat_count: parseInt(document.getElementById('repeat_count')?.value || '10')
                    };
                    params.push(...toLittleEndian16(ecgParams.trigger_delay_ms));
                    params.push(...toLittleEndian16(ecgParams.stop_delay_ms));
                    params.push(...toLittleEndian16(ecgParams.interval_R));
                    params.push(...toLittleEndian16(ecgParams.repeat_count));
                    break;
                    
                case 0x38: // è®¾ç½®è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼
                    const channel = parseInt(document.getElementById('ocdChannel')?.value || '0');
                    const voltage = parseInt(document.getElementById('ocdVoltage')?.value || '1650');
                    params.push(channel);
                    params.push(...toLittleEndian16(voltage));
                    break;
                    
                case 0x39: // è·å–è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼
                    const getChannel = parseInt(document.getElementById('ocdGetChannel')?.value || '0');
                    params.push(getChannel);
                    break;
                    
                case 0x0C: // çŠ¶æ€ä¸Šä¼ 
                case 0x3A: // è„‰å†²åºåˆ—è¾“å‡ºå®ŒæˆçŠ¶æ€ä¸ŠæŠ¥
                    const customData = document.getElementById('customData')?.value || '';
                    if (customData) {
                        const bytes = hexStringToBytes(customData);
                        params.push(...bytes);
                    }
                    break;
            }
            
            return params;
        }
        
        // ç”Ÿæˆå‘½ä»¤å‚æ•°è¾“å…¥ç•Œé¢
        function generateParamUI() {
            const cmd = parseInt(document.getElementById('cmdCode').value);
            const frameType = document.getElementById('frameType').value;
            const container = document.getElementById('paramContainer');
            container.innerHTML = '';
            
            if (frameType === 'response') {
                // åº”ç­”å¸§å¯èƒ½éœ€è¦å“åº”æ•°æ®
                switch(cmd) {
                    case 0x02: // æŸ¥è¯¢è½¯ä»¶ç‰ˆæœ¬
                    case 0x04: // æŸ¥è¯¢ç¡¬ä»¶ç‰ˆæœ¬
                    case 0x06: // æŸ¥è¯¢åºåˆ—å·
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">å“åº”æ•°æ® (å­—ç¬¦ä¸²)</div>
                                <input type="text" id="responseString" placeholder="ä¾‹å¦‚: V1.0.0 æˆ– HW_V1.0 æˆ– SN12345678" />
                            </div>
                        `;
                        break;
                    case 0x31: // è·å–è„‰å†²åºåˆ—è¾“å‡ºçŠ¶æ€
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è„‰å†²çŠ¶æ€</div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>æ¨¡å¼</label>
                                        <select id="responsePulseMode">
                                            <option value="0">0 - æ­£å¸¸æ¨¡å¼</option>
                                            <option value="1">1 - å¿ƒç”µåŒæ­¥è§¦å‘æ¨¡å¼</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>çŠ¶æ€</label>
                                        <select id="responsePulseStatus">
                                            <option value="0">0 - ç©ºé—²</option>
                                            <option value="1">1 - è¿è¡Œä¸­</option>
                                            <option value="2">2 - å®Œæˆ</option>
                                            <option value="3">3 - é”™è¯¯</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>æ¬¡æ•°</label>
                                        <input type="number" id="responsePulseCount" value="0" min="0" max="65535" />
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 0x33: // è·å–è„‰å†²åºåˆ—è¾“å‡ºæ¨¡å¼
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è„‰å†²æ¨¡å¼</div>
                                <select id="responsePulseModeOnly">
                                    <option value="0">0 - æ­£å¸¸æ¨¡å¼</option>
                                    <option value="1">1 - å¿ƒç”µåŒæ­¥è§¦å‘æ¨¡å¼</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 0x35: // è·å–è„‰å†²åºåˆ—å‚æ•°
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è„‰å†²å‚æ•°ç»„æ•°</div>
                                <input type="number" id="responsePulseParamGroups" value="1" min="1" max="20" />
                                <div class="help-text">å°†ç”Ÿæˆå¯¹åº”æ•°é‡çš„å‚æ•°ç»„ï¼Œæ¯ç»„20å­—èŠ‚</div>
                            </div>
                            <div class="alert alert-info">
                                æç¤ºï¼šå®é™…ä½¿ç”¨æ—¶ï¼Œå‚æ•°æ•°æ®åº”ä»è®¾å¤‡è·å–ã€‚è¿™é‡Œå¯ä»¥æ‰‹åŠ¨è¾“å…¥åå…­è¿›åˆ¶æ•°æ®ã€‚
                            </div>
                            <div class="param-group">
                                <div class="param-group-title">å‚æ•°æ•°æ® (åå…­è¿›åˆ¶ï¼Œå¯é€‰)</div>
                                <textarea id="responsePulseParams" rows="3" placeholder="ä¾‹å¦‚: 02 01 64 00 0A 00 05 00 14 00 E8 03 F4 01 E8 03 F4 01"></textarea>
                                <div class="help-text">æ¯20å­—èŠ‚ä¸ºä¸€ç»„å‚æ•°ï¼Œå¤šç»„å‚æ•°è¿ç»­è¾“å…¥</div>
                            </div>
                        `;
                        break;
                    case 0x37: // è·å–å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•°
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">å¿ƒç”µåŒæ­¥å‚æ•°</div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>è§¦å‘å»¶æ—¶ (ms)</label>
                                        <input type="number" id="responseTriggerDelay" value="50" min="0" max="300" />
                                    </div>
                                    <div class="form-group">
                                        <label>åœæ­¢æ—¶é—´ (ms)</label>
                                        <input type="number" id="responseStopDelay" value="500" min="200" max="2000" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>Ræ³¢é—´éš”ä¸ªæ•°</label>
                                        <input type="number" id="responseIntervalR" value="2" min="0" max="30" />
                                    </div>
                                    <div class="form-group">
                                        <label>é‡å¤æ¬¡æ•°</label>
                                        <input type="number" id="responseRepeatCount" value="10" min="1" max="300" />
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 0x39: // è·å–è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">ç”µå‹é˜ˆå€¼</div>
                                <input type="number" id="responseOcdVoltage" value="1650" min="0" max="3300" />
                                <div class="help-text">å•ä½: mV</div>
                            </div>
                        `;
                        break;
                    default:
                        container.innerHTML = `
                            <div class="alert alert-info">
                                æ­¤å‘½ä»¤æ— éœ€é¢å¤–å‚æ•°ï¼Œæˆ–ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®è¾“å…¥
                            </div>
                            <div class="param-group">
                                <div class="param-group-title">è‡ªå®šä¹‰æ•°æ® (åå…­è¿›åˆ¶ï¼Œå¯é€‰)</div>
                                <textarea id="customResponseData" rows="3" placeholder="ä¾‹å¦‚: 01 02 03 04"></textarea>
                            </div>
                        `;
                        break;
                }
            } else {
                // å‘½ä»¤å¸§å‚æ•°
                switch(cmd) {
                    case 0x03: // è®¾ç½®ç¡¬ä»¶ç‰ˆæœ¬
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">ç¡¬ä»¶ç‰ˆæœ¬å­—ç¬¦ä¸²</div>
                                <input type="text" id="hwVersion" placeholder="ä¾‹å¦‚: HW_V1.0" />
                            </div>
                        `;
                        break;
                    case 0x05: // è®¾ç½®åºåˆ—å·
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">åºåˆ—å·å­—ç¬¦ä¸²</div>
                                <input type="text" id="serialNumber" placeholder="ä¾‹å¦‚: SN12345678" />
                            </div>
                        `;
                        break;
                    case 0x30: // æ§åˆ¶è„‰å†²åºåˆ—è¾“å‡º
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">æ§åˆ¶ç </div>
                                <select id="pulseControl">
                                    <option value="0">0 - åœæ­¢è„‰å†²è¾“å‡º</option>
                                    <option value="1">1 - å¯åŠ¨è„‰å†²è¾“å‡º</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 0x32: // è®¾ç½®è„‰å†²åºåˆ—è¾“å‡ºæ¨¡å¼
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è„‰å†²æ¨¡å¼</div>
                                <select id="pulseMode">
                                    <option value="0">0 - æ­£å¸¸æ¨¡å¼</option>
                                    <option value="1">1 - å¿ƒç”µåŒæ­¥è§¦å‘æ¨¡å¼</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 0x34: // è®¾ç½®è„‰å†²åºåˆ—å‚æ•°
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è„‰å†²åºåˆ—å‚æ•° (20å­—èŠ‚)</div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>ç¾¤ä¸ªæ•°</label>
                                        <input type="number" id="num_of_group" value="1" min="1" max="20" />
                                    </div>
                                    <div class="form-group">
                                        <label>ç¾¤ç¼–å·</label>
                                        <input type="number" id="group_num" value="1" min="1" max="20" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>ç¾¤é—´éš™ (ms)</label>
                                        <input type="number" id="group_gap" value="100" min="50" max="10000" />
                                    </div>
                                    <div class="form-group">
                                        <label>æ¯ç¾¤è„‰å†²ä¸²æ•°é‡</label>
                                        <input type="number" id="train_per_group" value="10" min="1" max="300" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>è„‰å†²ä¸²é—´éš™ (ms)</label>
                                        <input type="number" id="train_gap" value="5" min="1" max="100" />
                                    </div>
                                    <div class="form-group">
                                        <label>æ¯ä¸²è„‰å†²å‘¨æœŸæ•°</label>
                                        <input type="number" id="periods_per_train" value="20" min="1" max="300" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>è´Ÿ-æ­£è„‰å†²é—´éš™ (ns)</label>
                                        <input type="number" id="np_gap" value="1000" min="0" />
                                    </div>
                                    <div class="form-group">
                                        <label>æ­£è„‰å®½ (ns)</label>
                                        <input type="number" id="pos_pw" value="500" min="0" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>æ­£-è´Ÿè„‰å†²é—´éš™ (ns)</label>
                                        <input type="number" id="pn_gap" value="1000" min="0" />
                                    </div>
                                    <div class="form-group">
                                        <label>è´Ÿè„‰å®½ (ns)</label>
                                        <input type="number" id="neg_pw" value="500" min="0" />
                                        <div class="help-text">0è¡¨ç¤ºå•ææ€§</div>
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 0x36: // è®¾ç½®å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•°
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•° (8å­—èŠ‚)</div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>è§¦å‘è¾“å‡ºå»¶æ—¶ (ms)</label>
                                        <input type="number" id="trigger_delay_ms" value="50" min="0" max="300" />
                                    </div>
                                    <div class="form-group">
                                        <label>åœæ­¢æ—¶é—´ (ms)</label>
                                        <input type="number" id="stop_delay_ms" value="500" min="200" max="2000" />
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>Ræ³¢é—´éš”ä¸ªæ•°</label>
                                        <input type="number" id="interval_R" value="2" min="0" max="30" />
                                    </div>
                                    <div class="form-group">
                                        <label>è¿ç»­è§¦å‘æ¬¡æ•°</label>
                                        <input type="number" id="repeat_count" value="10" min="1" max="300" />
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 0x38: // è®¾ç½®è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼ (3å­—èŠ‚)</div>
                                <div class="row">
                                    <div class="form-group">
                                        <label>é€šé“</label>
                                        <select id="ocdChannel">
                                            <option value="0">0 - é€šé“1 (ADC1/COMP3, DAC1)</option>
                                            <option value="1">1 - é€šé“2 (ADC2/COMP1, DAC3)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>ç”µå‹é˜ˆå€¼ (mV)</label>
                                        <input type="number" id="ocdVoltage" value="1650" min="0" max="3300" />
                                    </div>
                                </div>
                            </div>
                        `;
                        break;
                    case 0x39: // è·å–è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">é€šé“é€‰æ‹©</div>
                                <select id="ocdGetChannel">
                                    <option value="0">0 - é€šé“1</option>
                                    <option value="1">1 - é€šé“2</option>
                                </select>
                            </div>
                        `;
                        break;
                    case 0x0C: // çŠ¶æ€ä¸Šä¼ 
                    case 0x3A: // è„‰å†²åºåˆ—è¾“å‡ºå®ŒæˆçŠ¶æ€ä¸ŠæŠ¥
                        container.innerHTML = `
                            <div class="param-group">
                                <div class="param-group-title">è‡ªå®šä¹‰æ•°æ® (åå…­è¿›åˆ¶)</div>
                                <textarea id="customData" rows="3" placeholder="ä¾‹å¦‚: 01 02 03 04 æˆ– 4E 6F 72 6D 61 6C 7C 4F 4B 7C 05 00"></textarea>
                                <div class="help-text">è¾“å…¥åå…­è¿›åˆ¶æ•°æ®ï¼Œç”¨ç©ºæ ¼åˆ†éš”</div>
                            </div>
                        `;
                        break;
                    default:
                        container.innerHTML = `
                            <div class="alert alert-info">
                                æ­¤å‘½ä»¤æ— éœ€å‚æ•°
                            </div>
                        `;
                        break;
                }
            }
        }
        
        // è·å–åº”ç­”å¸§çš„å“åº”æ•°æ®
        function getResponseData() {
            const cmd = parseInt(document.getElementById('cmdCode').value);
            const params = [];
            
            switch(cmd) {
                case 0x02: // æŸ¥è¯¢è½¯ä»¶ç‰ˆæœ¬
                case 0x04: // æŸ¥è¯¢ç¡¬ä»¶ç‰ˆæœ¬
                case 0x06: // æŸ¥è¯¢åºåˆ—å·
                    const responseString = document.getElementById('responseString')?.value || '';
                    if (responseString) {
                        for (let i = 0; i < responseString.length; i++) {
                            params.push(responseString.charCodeAt(i));
                        }
                    }
                    break;
                    
                case 0x31: // è·å–è„‰å†²åºåˆ—è¾“å‡ºçŠ¶æ€
                    const mode = parseInt(document.getElementById('responsePulseMode')?.value || '0');
                    const status = parseInt(document.getElementById('responsePulseStatus')?.value || '0');
                    const count = parseInt(document.getElementById('responsePulseCount')?.value || '0');
                    params.push(mode);
                    params.push(status);
                    params.push(...toLittleEndian16(count));
                    break;
                    
                case 0x33: // è·å–è„‰å†²åºåˆ—è¾“å‡ºæ¨¡å¼
                    const modeOnly = parseInt(document.getElementById('responsePulseModeOnly')?.value || '0');
                    params.push(modeOnly);
                    break;
                    
                case 0x35: // è·å–è„‰å†²åºåˆ—å‚æ•°
                    const customParams = document.getElementById('responsePulseParams')?.value || '';
                    if (customParams) {
                        const bytes = hexStringToBytes(customParams);
                        params.push(...bytes);
                    } else {
                        // ç”Ÿæˆé»˜è®¤å‚æ•°ç»„
                        const groups = parseInt(document.getElementById('responsePulseParamGroups')?.value || '1');
                        for (let g = 0; g < groups; g++) {
                            // é»˜è®¤å‚æ•°ï¼šç¾¤ä¸ªæ•°=1, ç¾¤ç¼–å·=1, å…¶ä»–é»˜è®¤å€¼
                            params.push(1); // num_of_group
                            params.push(1); // group_num
                            params.push(...toLittleEndian16(100)); // group_gap
                            params.push(...toLittleEndian16(10)); // train_per_group
                            params.push(...toLittleEndian16(5)); // train_gap
                            params.push(...toLittleEndian16(20)); // periods_per_train
                            params.push(...toLittleEndian16(1000)); // np_gap
                            params.push(...toLittleEndian16(500)); // pos_pw
                            params.push(...toLittleEndian16(1000)); // pn_gap
                            params.push(...toLittleEndian16(500)); // neg_pw
                        }
                    }
                    break;
                    
                case 0x37: // è·å–å¿ƒç”µåŒæ­¥è§¦å‘å‚æ•°
                    const triggerDelay = parseInt(document.getElementById('responseTriggerDelay')?.value || '50');
                    const stopDelay = parseInt(document.getElementById('responseStopDelay')?.value || '500');
                    const intervalR = parseInt(document.getElementById('responseIntervalR')?.value || '2');
                    const repeatCount = parseInt(document.getElementById('responseRepeatCount')?.value || '10');
                    params.push(...toLittleEndian16(triggerDelay));
                    params.push(...toLittleEndian16(stopDelay));
                    params.push(...toLittleEndian16(intervalR));
                    params.push(...toLittleEndian16(repeatCount));
                    break;
                    
                case 0x39: // è·å–è¿‡æµæ£€æµ‹ç”µå‹é˜ˆå€¼
                    const voltage = parseInt(document.getElementById('responseOcdVoltage')?.value || '1650');
                    params.push(...toLittleEndian16(voltage));
                    break;
                    
                default:
                    const customResponseData = document.getElementById('customResponseData')?.value || '';
                    if (customResponseData) {
                        const bytes = hexStringToBytes(customResponseData);
                        params.push(...bytes);
                    }
                    break;
            }
            
            return params;
        }
        
        // ç”Ÿæˆå¸§æ•°æ®
        function generateFrame() {
            try {
                const frameType = document.getElementById('frameType').value;
                const dev = parseInt(document.getElementById('devAddr').value);
                const mod = parseInt(document.getElementById('modAddr').value);
                const cmd = parseInt(document.getElementById('cmdCode').value);
                
                const frame = [];
                
                // å¸§å¤´
                frame.push(0xFA);
                
                // å…ˆæ„å»ºpayloadéƒ¨åˆ†ï¼ˆä¸å«é•¿åº¦å’ŒCRCï¼‰
                const payload = [];
                payload.push(dev);
                payload.push(cmd);
                payload.push(mod);
                
                let dataParams = [];
                
                if (frameType === 'response') {
                    // åº”ç­”å¸§ï¼šæ·»åŠ åº”ç­”ç 
                    const ack = parseInt(document.getElementById('ackCode').value);
                    payload.push(ack);
                    // è·å–å“åº”æ•°æ®
                    dataParams = getResponseData();
                } else {
                    // å‘½ä»¤å¸§ï¼šè·å–å‘½ä»¤å‚æ•°
                    dataParams = getCommandParams();
                }
                
                // æ·»åŠ æ•°æ®è½½è·
                payload.push(...dataParams);
                
                // è®¡ç®—æ€»é•¿åº¦ï¼ˆå¸§å¤´ + é•¿åº¦å­—æ®µ + payload + CRC + å¸§å°¾ï¼‰
                const totalLen = 1 + 2 + payload.length + 2 + 1;
                
                // æ£€æŸ¥é•¿åº¦é™åˆ¶
                if (totalLen > 64) {
                    alert('é”™è¯¯ï¼šå¸§é•¿åº¦è¶…è¿‡64å­—èŠ‚é™åˆ¶ï¼å½“å‰é•¿åº¦ï¼š' + totalLen);
                    return;
                }
                
                // æ·»åŠ é•¿åº¦å­—æ®µï¼ˆå°ç«¯ï¼‰
                frame.push(...toLittleEndian16(totalLen));
                
                // æ·»åŠ payload
                frame.push(...payload);
                
                // è®¡ç®—CRC16ï¼ˆä»é•¿åº¦å­—æ®µå¼€å§‹åˆ°æ•°æ®è½½è·ç»“æŸï¼‰
                const crcData = frame.slice(1); // ä»é•¿åº¦å­—æ®µå¼€å§‹
                const crc = crc16_modbus(crcData);
                
                // æ·»åŠ CRC16ï¼ˆå°ç«¯ï¼‰
                frame.push(...toLittleEndian16(crc));
                
                // å¸§å°¾
                frame.push(0x0D);
                
                // æ˜¾ç¤ºç»“æœ
                displayResult(frame, payload, dataParams, frameType, cmd);
                
            } catch (error) {
                alert('ç”Ÿæˆå¸§æ•°æ®æ—¶å‡ºé”™ï¼š' + error.message);
                console.error(error);
            }
        }
        
        // æ˜¾ç¤ºç”Ÿæˆç»“æœ
        function displayResult(frame, payload, dataParams, frameType, cmd) {
            const resultSection = document.getElementById('resultSection');
            resultSection.style.display = 'block';
            
            // åå…­è¿›åˆ¶æ ¼å¼
            const hexResult = document.getElementById('hexResult');
            hexResult.textContent = bytesToHexString(frame, ' ');
            
            // Cè¯­è¨€æ•°ç»„æ ¼å¼
            const cArrayResult = document.getElementById('cArrayResult');
            const cArray = 'uint8_t frame[] = {' + frame.map(b => '0x' + b.toString(16).padStart(2, '0').toUpperCase()).join(', ') + '};';
            cArrayResult.textContent = cArray;
            
            // å¸§ç»“æ„è§£æ
            const frameParseResult = document.getElementById('frameParseResult');
            let parseText = 'å¸§ç»“æ„è§£æï¼š\n';
            parseText += 'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            parseText += `å¸§ç±»å‹: ${frameType === 'command' ? 'å‘½ä»¤å¸§' : 'åº”ç­”å¸§'}\n`;
            parseText += `æ€»é•¿åº¦: ${frame.length} å­—èŠ‚\n`;
            parseText += `\nå­—èŠ‚åˆ†è§£ï¼š\n`;
            parseText += `[0]     å¸§å¤´: 0x${frame[0].toString(16).padStart(2, '0').toUpperCase()}\n`;
            parseText += `[1-2]   é•¿åº¦: 0x${frame[1].toString(16).padStart(2, '0').toUpperCase()} 0x${frame[2].toString(16).padStart(2, '0').toUpperCase()} (${frame[1] | (frame[2] << 8)} å­—èŠ‚)\n`;
            parseText += `[3]     è®¾å¤‡åœ°å€: 0x${frame[3].toString(16).padStart(2, '0').toUpperCase()}\n`;
            parseText += `[4]     å‘½ä»¤ç : 0x${frame[4].toString(16).padStart(2, '0').toUpperCase()}\n`;
            parseText += `[5]     æ¨¡å—åœ°å€: 0x${frame[5].toString(16).padStart(2, '0').toUpperCase()}\n`;
            
            if (frameType === 'response') {
                parseText += `[6]     åº”ç­”ç : 0x${frame[6].toString(16).padStart(2, '0').toUpperCase()}\n`;
                if (dataParams.length > 0) {
                    parseText += `[7-${6 + dataParams.length}] æ•°æ®è½½è·: ${bytesToHexString(dataParams, ' ')}\n`;
                    parseText += `        (${dataParams.length} å­—èŠ‚)\n`;
                }
                const crcStart = 7 + dataParams.length;
                parseText += `[${crcStart}-${crcStart + 1}] CRC16: 0x${frame[crcStart].toString(16).padStart(2, '0').toUpperCase()} 0x${frame[crcStart + 1].toString(16).padStart(2, '0').toUpperCase()}\n`;
                parseText += `[${crcStart + 2}] å¸§å°¾: 0x${frame[crcStart + 2].toString(16).padStart(2, '0').toUpperCase()}\n`;
            } else {
                if (dataParams.length > 0) {
                    parseText += `[6-${5 + dataParams.length}] æ•°æ®è½½è·: ${bytesToHexString(dataParams, ' ')}\n`;
                    parseText += `        (${dataParams.length} å­—èŠ‚)\n`;
                }
                const crcStart = 6 + dataParams.length;
                parseText += `[${crcStart}-${crcStart + 1}] CRC16: 0x${frame[crcStart].toString(16).padStart(2, '0').toUpperCase()} 0x${frame[crcStart + 1].toString(16).padStart(2, '0').toUpperCase()}\n`;
                parseText += `[${crcStart + 2}] å¸§å°¾: 0x${frame[crcStart + 2].toString(16).padStart(2, '0').toUpperCase()}\n`;
            }
            
            frameParseResult.textContent = parseText;
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥ï¼š', err);
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }
        
        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } catch (err) {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            }
            document.body.removeChild(textArea);
        }
        
        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            document.getElementById('devAddr').value = '3';
            document.getElementById('modAddr').value = '2';
            document.getElementById('cmdCode').selectedIndex = 0;
            document.getElementById('ackCode').selectedIndex = 0;
            document.getElementById('frameType').selectedIndex = 0;
            document.getElementById('paramContainer').innerHTML = '<div class="alert alert-info">é€‰æ‹©å‘½ä»¤åå°†æ˜¾ç¤ºå¯¹åº”çš„å‚æ•°è¾“å…¥ç•Œé¢</div>';
            document.getElementById('resultSection').style.display = 'none';
            generateParamUI();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç›‘å¬å¸§ç±»å‹å˜åŒ–
            document.getElementById('frameType').addEventListener('change', function() {
                generateParamUI();
                const responseAckGroup = document.getElementById('responseAckGroup');
                if (this.value === 'response') {
                    responseAckGroup.classList.remove('hidden');
                } else {
                    responseAckGroup.classList.add('hidden');
                }
            });
            
            // ç›‘å¬å‘½ä»¤ç å˜åŒ–
            document.getElementById('cmdCode').addEventListener('change', generateParamUI);
            
            // åˆå§‹åŒ–å‚æ•°ç•Œé¢
            generateParamUI();
        });
    </script>
</body>
</html>